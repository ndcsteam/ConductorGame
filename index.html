<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡æ®å®¶éŠæˆ²ï¼šç¯€æ‹å¤§å¸«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#d4af37', // é‡‘è‰²
                        secondary: '#8b4513', // æ·±æ£•è‰²
                        accent: '#964B00', // éŠ…è‰²
                        success: '#4CAF50',
                        warning: '#FF9800',
                        danger: '#F44336',
                        conductor: {
                            dark: '#121212',
                            medium: '#1a1a1a',
                            light: '#222222',
                            gold: '#d4af37',
                            copper: '#964B00',
                            velvet: '#5D0A0A',
                            wood: '#5d4037',
                        }
                    },
                    fontFamily: {
                        'sans': ['Noto Sans TC', 'sans-serif'],
                    },
                    animation: {
                        'spotlight': 'spotlight 5s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite',
                        'fade-in': 'fadeIn 1s ease-out forwards',
                        'fade-out': 'fadeOut 1s ease-out forwards',
                        'conductor': 'conductor 1s ease-in-out infinite',
                        'float-slow': 'float 20s ease-in-out infinite',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        spotlight: {
                            '0%': { opacity: 0.5, transform: 'translate(-30%, -30%) scale(0.8)' },
                            '50%': { opacity: 0.8, transform: 'translate(-25%, -25%) scale(1)' },
                            '100%': { opacity: 0.5, transform: 'translate(-30%, -30%) scale(0.8)' },
                        },
                        glow: {
                            '0%, 100%': { filter: 'brightness(1)' },
                            '50%': { filter: 'brightness(1.2)' },
                        },
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        fadeOut: {
                            '0%': { opacity: 1 },
                            '100%': { opacity: 0 },
                        },
                        conductor: {
                            '0%, 100%': { transform: 'rotate(-5deg)' },
                            '50%': { transform: 'rotate(15deg)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        pulse: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.7 },
                        }
                    },
                    backgroundImage: {
                        'stage-texture': "url('data:image/svg+xml,%3Csvg width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cpath d=\"M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z\" fill=\"%239C92AC\" fill-opacity=\"0.05\" fill-rule=\"evenodd\"/%3E%3C/svg%3E')",
                    }
                }
            }
        }
    </script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Noto Sans TC', sans-serif;
            position: relative;
            overflow-x: hidden;
        }
        
        /* èˆå°å’Œèšå…‰ç‡ˆæ•ˆæœ */
        .concert-hall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(212, 175, 55, 0.08) 0%, rgba(212, 175, 55, 0) 50%),
                linear-gradient(180deg, #121212 0%, #0a0a0a 100%);
            z-index: -2;
        }
        
        .spotlights {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .spotlight {
            position: absolute;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.15) 0%, rgba(212, 175, 55, 0) 70%);
            width: 100%;
            height: 100%;
            opacity: 0;
            transform-origin: center;
        }
        
        .spotlight-1 {
            top: 0;
            left: 0;
            animation: spotlight-1 15s ease-in-out infinite;
        }
        
        .spotlight-2 {
            top: 0;
            right: 0;
            animation: spotlight-2 18s ease-in-out infinite 2s;
        }
        
        .spotlight-3 {
            bottom: 0;
            left: 30%;
            animation: spotlight-3 20s ease-in-out infinite 5s;
        }
        
        @keyframes spotlight-1 {
            0%, 100% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 0.6; transform: scale(1); }
        }
        
        @keyframes spotlight-2 {
            0%, 100% { opacity: 0.3; transform: scale(0.7) rotate(-15deg); }
            50% { opacity: 0.5; transform: scale(0.9) rotate(-5deg); }
        }
        
        @keyframes spotlight-3 {
            0%, 100% { opacity: 0.3; transform: scale(0.7) rotate(10deg); }
            50% { opacity: 0.5; transform: scale(0.9) rotate(5deg); }
        }
        
        /* èˆå°ç´‹ç† */
        .stage-texture {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z" fill="%239C92AC" fill-opacity="0.05" fill-rule="evenodd"/%3E%3C/svg%3E');
            opacity: 0.12;
            z-index: -1;
        }
        
        /* æŒ‡æ®å°æ•ˆæœ */
        .conductor-stage {
            background: linear-gradient(180deg, rgba(93, 64, 55, 0.4) 0%, rgba(93, 64, 55, 0.25) 100%);
            border: 1px solid rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5),
                        inset 0 0 15px rgba(212, 175, 55, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .conductor-stage::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.05) 0%, rgba(212, 175, 55, 0) 50%);
            pointer-events: none;
        }
        
        /* æ—‹å¾‹æ³¢æµª */
        .melody-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, rgba(212, 175, 55, 0) 0%, rgba(212, 175, 55, 0.2) 50%, rgba(212, 175, 55, 0) 100%);
            filter: blur(2px);
            opacity: 0;
            transform: translateY(10px);
            z-index: 1;
        }
        
        .melody-wave.active {
            animation: wave 1.2s ease-out;
        }
        
        @keyframes wave {
            0% { opacity: 0; transform: translateY(10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; width: 100%; }
            100% { opacity: 0; width: 100%; transform: translateY(0); }
        }
        
        /* é‡‘è‰²è£é£¾ç·š */
        .gold-divider {
            height: 1px;
            background: linear-gradient(90deg, rgba(212, 175, 55, 0) 0%, rgba(212, 175, 55, 0.5) 50%, rgba(212, 175, 55, 0) 100%);
            margin: 12px 0;
        }
        
        /* å„ªé›…æŒ‰éˆ• */
        .elegant-button {
            background: linear-gradient(to bottom, rgba(212, 175, 55, 0.2), rgba(150, 75, 0, 0.2));
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: rgba(212, 175, 55, 0.9);
            letter-spacing: 0.05em;
            padding: 8px 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
        }
        
        .elegant-button:hover {
            background: linear-gradient(to bottom, rgba(212, 175, 55, 0.3), rgba(150, 75, 0, 0.3));
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }
        
        .elegant-button:active {
            transform: translateY(1px);
        }
        
        .elegant-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .elegant-button:hover::after {
            left: 100%;
        }
        
        /* Cover Page ç‰¹æ•ˆ */
        .cover-page {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-image: url('./images/stage.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        /* èƒŒæ™¯æš—åŒ–è¦†è“‹å±¤ */
        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 0;
        }
        
        /* ç¢ºä¿å…§å®¹é¡¯ç¤ºåœ¨è¦†è“‹å±¤ä¸Šæ–¹ */
        .cover-page > * {
            position: relative;
            z-index: 1;
        }
        
        .cover-title {
            position: relative;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
            letter-spacing: 0.1em;
        }
        
        .cover-subtitle {
            position: relative;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }
        
        .grand-button {
            background: linear-gradient(to bottom, rgba(212, 175, 55, 0.3), rgba(150, 75, 0, 0.3));
            border: 1px solid rgba(212, 175, 55, 0.5);
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
            letter-spacing: 0.1em;
            padding: 12px 28px;
            font-size: 1.2rem;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .grand-button:hover {
            background: linear-gradient(to bottom, rgba(212, 175, 55, 0.4), rgba(150, 75, 0, 0.4));
            border-color: rgba(212, 175, 55, 0.7);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4), 0 0 15px rgba(212, 175, 55, 0.4);
            transform: translateY(-2px);
        }
        
        .grand-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .grand-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.7s;
        }
        
        .grand-button:hover::after {
            left: 100%;
        }
        
        .orchestra-image {
            position: relative;
            width: 90%;
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.7;
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.2));
        }
        
        .floating-note {
            position: absolute;
            color: rgba(212, 175, 55, 0.3);
            font-size: 2rem;
            filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.2));
            pointer-events: none;
            animation-duration: calc(15s + (var(--note-index) * 5s));
            animation-delay: calc(var(--note-index) * 2s);
        }
        
        /* éµç›¤æŒ‡ç¤ºå™¨æ¨£å¼ */
        .keyboard-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }
        
        .key {
            width: 30px;
            height: 30px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
            color: rgba(212, 175, 55, 0.8);
            font-size: 14px;
            background: rgba(93, 64, 55, 0.15);
        }
        
        /* é é¢è½‰å ´ */
        .page-transition {
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        
        .page-hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
        }
        
        /* æŒ‡æ®æ£’å‹•ç•« */
        .conductor-wand {
            transform-origin: bottom center;
            position: relative;
        }
        
        .conducting {
            animation: conducting 0.5s ease-in-out;
        }
        
        @keyframes conducting {
            0% { transform: rotate(-20deg); }
            50% { transform: rotate(30deg); }
            100% { transform: rotate(-10deg); }
        }
        
        /* æŒ‡æ®æ£’åå…‰æ•ˆæœ */
        .wand-highlight {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 70%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.7), transparent);
            opacity: 0.4;
        }
        
        /* åæ‡‰æ€§æŒ‡ç¤ºå™¨ */
        .reactive-indicator {
            transition: all 0.3s ease;
        }
        
        .reactive-indicator.active {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        
        /* ç²¾æº–åº¦æŒ‡ç¤ºå™¨å¢å¼· */
        .accuracy-bar-container {
            position: relative;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 999px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }
        
        .accuracy-bar {
            height: 100%;
            border-radius: 999px;
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.5), rgba(212, 175, 55, 0.8));
            transition: width 0.5s ease-out;
            position: relative;
        }
        
        .accuracy-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), transparent);
            border-radius: 999px 999px 0 0;
        }
        
        /* éŸ³ç¬¦è£é£¾ */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .music-note {
            position: absolute;
            opacity: 0.1;
            pointer-events: none;
        }
        
        .note-1 {
            top: 20%;
            left: 10%;
            animation: float 10s ease-in-out infinite;
        }
        
        .note-2 {
            top: 60%;
            right: 15%;
            animation: float 13s ease-in-out infinite 1s;
        }
        
        .note-3 {
            bottom: 15%;
            left: 20%;
            animation: float 15s ease-in-out infinite 2s;
        }
        
        /* æ¨¡æ“¬èˆå°ç…§æ˜ */
        .stage-lighting {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        .stage-lighting.active {
            opacity: 1;
        }
        
        .lighting-beam {
            position: absolute;
            width: 150px;
            height: 150%;
            background: radial-gradient(ellipse at top, rgba(212, 175, 55, 0.1), transparent 70%);
            transform-origin: top center;
        }
        
        .beam-1 {
            left: 20%;
            transform: rotate(-20deg);
            animation: beam-move-1 10s infinite alternate;
        }
        
        .beam-2 {
            left: 50%;
            transform: rotate(0deg);
            animation: beam-move-2 15s infinite alternate-reverse;
        }
        
        .beam-3 {
            right: 20%;
            transform: rotate(20deg);
            animation: beam-move-3 12s infinite alternate;
        }
        
        @keyframes beam-move-1 {
            0% { transform: rotate(-25deg); }
            100% { transform: rotate(-15deg); }
        }
        
        @keyframes beam-move-2 {
            0% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }
        
        @keyframes beam-move-3 {
            0% { transform: rotate(15deg); }
            100% { transform: rotate(25deg); }
        }
        
        /* æ¨¡æ“¬æœ¨è³ªæŒ‡æ®å° */
        .podium {
            background: linear-gradient(135deg, #5d4037 0%, #3e2723 100%);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .podium::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,%3Csvg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M0 0h20v20H0V0zm10 17L0 27v10h10V17zm10 0L10 27v10h10V17zM0 0v7l10 10h20V0H0z" fill="%23000000" fill-opacity="0.1" fill-rule="evenodd"/%3E%3C/svg%3E');
            opacity: 0.1;
        }
        
        /* æ¨¡æ“¬çµ²çµ¨çª—ç°¾ */
        .velvet-curtain {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: #5D0A0A; /* æ·±ç´…çµ²çµ¨è‰² */
            box-shadow: 0 0 10px rgba(93, 10, 10, 0.5);
            z-index: 1;
        }
        
        /* BPM è„ˆå‹•æ•ˆæœ */
        .bpm-pulse {
            animation: bpm-pulse 0.5s ease-in-out;
        }
        
        @keyframes bpm-pulse {
            0% { transform: scale(1); color: rgba(212, 175, 55, 0.9); }
            50% { transform: scale(1.1); color: rgba(212, 175, 55, 1); text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
            100% { transform: scale(1); color: rgba(212, 175, 55, 0.9); }
        }
        
        /* æŒ‡æ®å®¶åœ–æ¨™å‹•ç•« */
        .conductor-icon {
            position: relative;
            transition: all 0.5s ease;
        }
        
        .conductor-icon:hover .conductor-wand {
            animation: conducting 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <!-- èˆå°èƒŒæ™¯æ•ˆæœ -->
    <div class="concert-hall"></div>
    <div class="spotlights">
        <div class="spotlight spotlight-1"></div>
        <div class="spotlight spotlight-2"></div>
        <div class="spotlight spotlight-3"></div>
    </div>
    <div class="stage-texture"></div>
    
    <!-- éŸ³ç¬¦è£é£¾ -->
    <div class="music-note note-1">â™ª</div>
    <div class="music-note note-2">â™«</div>
    <div class="music-note note-3">â™©</div>
    
    <!-- å°é¢é  -->
    <div id="cover-page" class="cover-page page-transition">
        <div id="music-notes-container" class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
            <!-- éŸ³ç¬¦å°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
        </div>
        
        <h1 class="cover-title text-5xl md:text-6xl font-bold mb-4 text-center text-conductor-gold">äº¤éŸ¿æ¨‚æŒ‡æ®å®¶</h1>
        <p class="cover-subtitle text-xl mb-8 text-center text-gray-300">å±•ç¾æ‚¨çš„éŸ³æ¨‚å¤©è³¦ï¼Œå¸¶é ˜æ¨‚åœ˜æ¼”ç¹¹ç¶“å…¸æ¨‚ç« </p>
        
        <div class="orchestra-image mb-10 mt-4">
            <div class="conductor-icon mx-auto relative">
                <img src="./images/ConductorFront.png" alt="æŒ‡æ®å®¶" class="w-auto h-48 object-contain mx-auto filter drop-shadow-2xl" />
            </div>
        </div>
        
        <button id="start-game-button" class="grand-button mb-8 animate-pulse-slow">
            é–‹å§‹æŒ‡æ®
        </button>
        
        <div class="text-center text-gray-400 text-sm max-w-md px-4">
            ä½¿ç”¨æ‚¨çš„ Micro:bit ä½œç‚ºæŒ‡æ®æ£’ï¼Œæˆ–ä½¿ç”¨éµç›¤ç©ºæ ¼éµæŒ‡æ®æ¨‚åœ˜ï¼Œé«”é©—éŸ³æ¨‚æŒ‡æ®çš„é­…åŠ›
        </div>
    </div>

    <!-- ä¸»éŠæˆ²å…§å®¹ -->
    <div id="main-content" class="container mx-auto px-4 py-8 max-w-3xl page-transition page-hidden">
        <h1 class="text-3xl font-bold mb-6 text-center text-conductor-gold">äº¤éŸ¿æ¨‚æŒ‡æ®å®¶</h1>

        <!-- éŠæˆ²ç‹€æ…‹è¦–çª— -->
        <div id="game-container" class="relative mb-8 p-6 rounded-lg shadow-lg conductor-stage">
            <!-- çµ²çµ¨çª—ç°¾è£é£¾ -->
            <div class="velvet-curtain"></div>
            
            <!-- èˆå°ç‡ˆå…‰æ•ˆæœ -->
            <div class="stage-lighting" id="stage-lighting">
                <div class="lighting-beam beam-1"></div>
                <div class="lighting-beam beam-2"></div>
                <div class="lighting-beam beam-3"></div>
            </div>
            
            <!-- æ—‹å¾‹æ³¢æµªæ•ˆæœ -->
            <div class="melody-wave" id="melody-wave"></div>
            
            <!-- æ¨™é¡Œèˆ‡é€£æ¥æŒ‰éˆ•å€åŸŸ -->
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h2 class="text-xl font-semibold mb-2 text-conductor-gold">æ­¡è¿é€²å…¥äº¤éŸ¿æ¨‚æ®¿å ‚</h2>
                    <p class="text-sm text-gray-400">æŒ‡æ®æ‚¨çš„éŸ³æ¨‚ä¹‹æ—…</p>
                </div>
                <div id="connection-panel" class="text-right">
                    <button id="connect-button" class="elegant-button">
                        é€£æ¥æŒ‡æ®æ£’
                    </button>
                    <div id="connection-status" class="mt-2 text-sm font-medium">æœªé€£æ¥</div>
                </div>
            </div>
            
            <div class="gold-divider"></div>

            <!-- éŠæˆ²æº–å‚™å€å¡Š -->
            <div id="setup-panel" class="hidden mb-6 pb-6">
                <h2 class="text-xl font-semibold mb-4 text-conductor-gold">é¸æ“‡æ¨‚ç« </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <select id="music-select" class="w-full py-2 px-3 border border-conductor-gold bg-conductor-dark text-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-conductor-gold/50">
                        <option value="game_start">åºæ›²ï¼šèˆå°æº–å‚™</option>
                        <option value="waltz">è¯çˆ¾æ»‹ï¼šè—è‰²å¤šç‘™æ²³ï¼ˆç›®æ¨™ BPM: 60ï¼‰</option>
                        <option value="march">é€²è¡Œæ›²ï¼šæ‹‰å¾·æ–¯åŸºï¼ˆç›®æ¨™ BPM: 108ï¼‰</option>
                        <option value="symphony">äº¤éŸ¿æ›²ï¼šå‘½é‹ä¹‹é–€ï¼ˆç›®æ¨™ BPM: 88ï¼‰</option>
                    </select>
                    <div class="mt-2 text-xs text-gray-400">
                        è¨ˆç®—æ–¹å¼ï¼šå¹³å‡ç¯€æ‹æ³• | éˆæ•åº¦èª¿æ•´ï¼š420ms
                    </div>
                    <button id="start-music-button" class="elegant-button">
                        é–‹å§‹æŒ‡æ®
                    </button>
                </div>
                <div class="text-sm text-gray-400">
                    è—è¡“æŒ‡å—ï¼šæ„Ÿå—æ¨‚æ›²ç¯€å¥ï¼Œæ®å‹•æ‚¨çš„æŒ‡æ®æ£’ï¼Œå±•ç¾æ‚¨çš„éŸ³æ¨‚é ˜å°åŠ›
                </div>
            </div>

            <!-- éŠæˆ²é€²è¡Œå€å¡Š -->
            <div id="game-panel" class="hidden">
                <!-- æŒ‡æ®å‹•ç•« -->
                <div class="flex justify-center items-center mb-8">
                    <div id="conductor-animation" class="relative h-56 w-56 flex justify-center items-center podium p-4 rounded-full">
                        <!-- æŒ‡æ®å®¶åœ–ç¤º -->
                        <div class="absolute bottom-0 w-full flex justify-center">
                            <div class="relative w-24 h-24 rounded-full bg-conductor-dark flex items-center justify-center border border-conductor-gold/20 shadow-xl">
                                <div class="w-20 h-20 rounded-full bg-conductor-medium flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-conductor-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                </div>
                                <!-- æŒ‡æ®æ£’ -->
                                <div id="conductor-wand" class="conductor-wand absolute h-28 w-1.5 bg-conductor-gold/90 rounded-full" style="bottom: 50%; transform: rotate(-10deg);">
                                    <div class="absolute top-0 left-0 right-0 h-4 rounded-full bg-white/80"></div>
                                    <div class="wand-highlight"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- éŠæˆ²ç‹€æ…‹ä¿¡æ¯ -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 rounded-lg bg-conductor-medium border border-conductor-gold/10 shadow text-center reactive-indicator">
                        <div class="text-sm text-gray-400 mb-1">æ‚¨çš„ç¯€å¥</div>
                        <div id="current-bpm" class="text-3xl font-bold text-conductor-gold">--</div>
                    </div>
                    <div class="p-4 rounded-lg bg-conductor-medium border border-conductor-gold/10 shadow text-center reactive-indicator">
                        <div class="text-sm text-gray-400 mb-1">æ¨‚æ›²ç¯€å¥</div>
                        <div id="target-bpm" class="text-3xl font-bold text-green-400">--</div>
                    </div>
                </div>
                
                <!-- éŸ³æ¨‚é€Ÿåº¦æç¤º -->
                <div id="speed-notification" class="hidden mb-6 py-2 px-4 rounded-lg text-center text-white transition-all duration-300 transform scale-100">
                    <span id="speed-text">éŸ³æ¨‚é€Ÿåº¦å·²èª¿æ•´</span>
                </div>

                <!-- BPM å·®ç•°æŒ‡ç¤ºå™¨ -->
                <div class="mb-6">
                    <div class="text-sm text-gray-400 mb-2">ç¯€å¥åå·®ï¼š<span id="bpm-diff" class="text-conductor-gold">--</span></div>
                    <div class="relative h-8 bg-conductor-dark/70 rounded-full overflow-hidden border border-conductor-gold/10">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-px h-full bg-conductor-gold/30"></div>
                        </div>
                        <div id="bpm-indicator" class="bpm-indicator absolute top-0 bottom-0 w-6 h-6 bg-conductor-gold rounded-full transform -translate-x-1/2 shadow-lg shadow-conductor-gold/20" style="left: 50%;">
                            <div class="absolute inset-0 rounded-full bg-conductor-gold/20 animate-pulse"></div>
                        </div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>éæ…¢</span>
                        <span>å®Œç¾</span>
                        <span>éå¿«</span>
                    </div>
                </div>

                <!-- ç·´ç¿’æ¨¡å¼æç¤º -->
                <div id="practice-mode-banner" class="hidden mb-6 py-3 px-4 rounded-lg bg-conductor-dark border border-conductor-gold/20 text-center">
                    <div class="text-lg font-semibold mb-1 text-conductor-gold"><span id="practice-countdown">10</span> ç§’é å‚™æ™‚é–“</div>
                    <div class="text-sm text-gray-400">è«‹æ„Ÿå—éŸ³æ¨‚ç¯€å¥ï¼ŒæŒæ¡æ¨‚æ›²æƒ…æ„Ÿï¼Œæ­¤éšæ®µç‚ºç†±èº«</div>
                </div>

                <!-- ç²¾æº–åº¦ -->
                <div class="mb-6">
                    <div class="flex justify-between text-sm font-medium mb-2">
                        <span>æŒ‡æ®ç²¾æº–åº¦</span>
                        <span id="accuracy-percent" class="text-conductor-gold">0%</span>
                    </div>
                    <div class="accuracy-bar-container h-3 rounded-full">
                        <div id="accuracy-bar" class="accuracy-bar h-full w-0"></div>
                    </div>
                    <div id="accuracy-text" class="accuracy-text text-center py-2 font-medium text-lg transition-colors"></div>
                </div>

                <!-- é€²åº¦æ¢ -->
                <div class="mb-6">
                    <div class="flex justify-between text-sm mb-1">
                        <div>æ¨‚ç« é€²åº¦</div>
                        <div id="time-display" class="text-conductor-gold/80">00:00 / 00:00</div>
                    </div>
                    <div class="w-full bg-conductor-dark/70 rounded-full h-2 overflow-hidden border border-conductor-gold/10">
                        <div id="progress-bar" class="bg-gradient-to-r from-conductor-gold/60 to-conductor-gold/80 h-2 rounded-full w-0 relative">
                            <div class="absolute inset-0 opacity-75 bg-conductor-gold/20 animate-pulse"></div>
                        </div>
                    </div>
                </div>

                <!-- éµç›¤æŒ‡ç¤ºå™¨ -->
                <div class="keyboard-indicator mb-4">
                    <div class="key">ç©ºæ ¼</div>
                    <span class="text-gray-400 flex items-center mx-2">æˆ–</span>
                    <div class="key">â†‘</div>
                    <span class="text-gray-400 flex items-center mx-2">æŒ‡æ®æ£’</span>
                </div>

                <!-- æ§åˆ¶æŒ‰éˆ• -->
                <div class="flex justify-center mt-6">
                    <button id="stop-game-button" class="elegant-button bg-conductor-velvet/20 border-conductor-velvet/30 text-rose-300/90">
                        çµæŸæ¼”å‡º
                    </button>
                </div>
            </div>

            <!-- éŠæˆ²çµæœå€å¡Š -->
            <div id="result-panel" class="hidden">
                <h2 class="text-xl font-semibold mb-4 text-center text-conductor-gold">æŒ‡æ®è¡¨ç¾è©•ä¼°</h2>
                <div class="p-6 rounded-lg bg-conductor-medium/70 border border-conductor-gold/20 shadow-lg mb-6">
                    <div id="result-title" class="text-2xl font-bold mb-4 text-center text-conductor-gold">ç²¾æ¹›æŒ‡æ®ï¼</div>
                    <div id="result-score" class="text-5xl font-bold text-conductor-gold mb-6 text-center">96%</div>
                    <div class="gold-divider"></div>
                    <div id="result-details" class="grid grid-cols-2 gap-x-8 gap-y-4 mb-6 max-w-sm mx-auto">
                        <div class="text-left">
                            <div class="text-sm text-gray-400">æ¨‚æ›²ç¯€å¥</div>
                            <div id="result-target-bpm" class="text-lg font-medium text-conductor-gold/90">60</div>
                        </div>
                        <div class="text-left">
                            <div class="text-sm text-gray-400">å¹³å‡ç¯€å¥</div>
                            <div id="result-average-bpm" class="text-lg font-medium text-conductor-gold/90">62</div>
                        </div>
                        <div class="text-left">
                            <div class="text-sm text-gray-400">ç²¾ç¢ºæŒ‡æ®</div>
                            <div id="result-accurate-beats" class="text-lg font-medium text-conductor-gold/90">45</div>
                        </div>
                        <div class="text-left">
                            <div class="text-sm text-gray-400">ç¸½æŒ‡æ®æ¬¡æ•¸</div>
                            <div id="result-total-beats" class="text-lg font-medium text-conductor-gold/90">48</div>
                        </div>
                    </div>
                    <div class="gold-divider"></div>
                    <div id="result-comment" class="text-gray-300 mb-6 italic text-center">
                        æ‚¨å±•ç¾äº†å“è¶Šçš„è—è¡“å¤©è³¦ï¼ŒéŸ³æ¨‚åœ¨æ‚¨çš„æŒ‡æ®ä¸‹æ ©æ ©å¦‚ç”Ÿï¼
                    </div>
                    <div class="flex justify-center">
                        <button id="play-again-button" class="elegant-button">
                            å†æ¬¡æŒ‡æ®
                        </button>
                    </div>
                </div>
            </div>

            <!-- éŸ³æ¨‚æ’­æ”¾å™¨ï¼ˆéš±è—ï¼‰ -->
            <audio id="game-audio" class="hidden"></audio>
        </div>


    </div>

    <script>
        // é é¢åˆ‡æ›æ§åˆ¶èˆ‡å‹•æ…‹éŸ³ç¬¦ç”Ÿæˆ
        document.addEventListener("DOMContentLoaded", function() {
            const coverPage = document.getElementById('cover-page');
            const mainContent = document.getElementById('main-content');
            const startGameButton = document.getElementById('start-game-button');
            const musicNotesContainer = document.getElementById('music-notes-container');
            
            // ç”Ÿæˆå‹•æ…‹éŸ³ç¬¦
            createDynamicMusicNotes();
            
            // é é¢åˆ‡æ›äº‹ä»¶
            startGameButton.addEventListener('click', function() {
                coverPage.classList.add('page-hidden');
                // æ¸…é™¤éŸ³ç¬¦ç”Ÿæˆ
                cleanupMusicNotes();
                setTimeout(() => {
                    mainContent.classList.remove('page-hidden');
                }, 400);
            });
            
            // ä¸­å¤®å‘å¤–æ“´æ•£çš„éŸ³ç¬¦å‡½æ•¸
            function createDynamicMusicNotes() {
                // æ¸…ç©ºå®¹å™¨
                musicNotesContainer.innerHTML = '';
                
                // éŸ³ç¬¦ç¬¦è™Ÿåº«
                const musicSymbols = ['â™©', 'â™ª', 'â™«', 'â™¬', 'ğ„', 'ğ…˜ğ…¥ğ…®', 'ğ…—ğ…¥', 'ğ„', 'ğ„‘'];
                
                // å‰µå»ºå›ºå®šæ•¸é‡çš„åˆå§‹éŸ³ç¬¦
                const initialNotes = 6;
                
                // æ·»åŠ ä¸­å¤®æ“´æ•£çš„å‹•ç•«æ¨£å¼ (ç„¡æ—‹è½‰)
                const centerRadiateStyle = document.createElement('style');
                centerRadiateStyle.textContent = `
                    @keyframes centerRadiate {
                        0% {
                            transform: translate(-50%, -50%) scale(0.5);
                            opacity: 0.6;
                        }
                        100% {
                            transform: translate(-50%, -50%) scale(3);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(centerRadiateStyle);
                
                // å®šæ™‚ç”Ÿæˆæ–°çš„éŸ³ç¬¦
                function createNote() {
                    // é¸æ“‡éš¨æ©ŸéŸ³ç¬¦ç¬¦è™Ÿ
                    const symbolIndex = Math.floor(Math.random() * musicSymbols.length);
                    const symbolText = musicSymbols[symbolIndex];
                    
                    // å‰µå»ºéŸ³ç¬¦å…ƒç´ 
                    const note = document.createElement('div');
                    note.className = 'absolute pointer-events-none origin-center';
                    note.textContent = symbolText;
                    
                    // è¨­ç½®åˆå§‹ä½ç½®ç‚ºä¸­å¤®
                    note.style.left = '50%';
                    note.style.top = '50%';
                    
                    // ç§»é™¤æ—‹è½‰è§’åº¦è¨­ç½® (åƒ…ä¿ç•™è®Šæ•¸ä»¥ä¾›å…¶ä»–è¨ˆç®—ä½¿ç”¨)
                    const rotationAngle = Math.floor(Math.random() * 360);
                    
                    // è¨­ç½®éš¨æ©ŸåŸºç¤å¤§å° (12-24px)
                    const baseSize = Math.floor(Math.random() * 13) + 12;
                    note.style.fontSize = `${baseSize}px`;
                    
                    // é‡‘è‰²æ•ˆæœ
                    note.style.color = 'rgba(212, 175, 55, 0.6)';
                    note.style.textShadow = '0 0 8px rgba(212, 175, 55, 0.3)';
                    
                    // è¨ˆç®—æ“´æ•£æ–¹å‘ (0-360åº¦)
                    const angle = Math.random() * 360;
                    
                    // è¨ˆç®—æ“´æ•£è·é›¢ (è¢å¹•å¯¬åº¦çš„50-150%)
                    const distance = 50 + Math.random() * 100;
                    
                    // è¨ˆç®—æœ€çµ‚ä½ç½®åç§»é‡
                    const finalX = Math.cos(angle * Math.PI / 180) * distance;
                    const finalY = Math.sin(angle * Math.PI / 180) * distance;
                    
                    // æ·»åŠ æ“´æ•£å‹•ç•« (ç„¡æ—‹è½‰)
                    const animationName = `centerRadiate_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    const keyframes = `
                    @keyframes ${animationName} {
                        0% {
                            transform: translate(-50%, -50%) scale(0.7);
                            opacity: 0.8;
                        }
                        100% {
                            transform: translate(calc(-50% + ${finalX}vw), calc(-50% + ${finalY}vh)) scale(2.5);
                            opacity: 0;
                        }
                    }`;
                    
                    const style = document.createElement('style');
                    style.textContent = keyframes;
                    document.head.appendChild(style);
                    
                    // è¨­ç½®å‹•ç•«æŒçºŒæ™‚é–“ (8-15ç§’)
                    const duration = 8 + Math.random() * 7;
                    note.style.animation = `${animationName} ${duration}s cubic-bezier(0.1, 0.2, 0.3, 1) forwards`;
                    
                    // æ·»åŠ è‡³å®¹å™¨
                    musicNotesContainer.appendChild(note);
                    
                    // è¨­ç½®å‹•ç•«çµæŸå¾Œç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        note.remove();
                        style.remove();
                    }, duration * 1000 + 100);
                }
                
                // åˆå§‹å‰µå»ºå¹¾å€‹éŸ³ç¬¦
                for (let i = 0; i < initialNotes; i++) {
                    setTimeout(() => createNote(), i * 300);
                }
                
                // è¨­ç½®å®šæ™‚å™¨ï¼Œæ¯éš”ä¸€æ®µæ™‚é–“ç”Ÿæˆæ–°çš„éŸ³ç¬¦
                const noteInterval = setInterval(() => {
                    if (!document.contains(musicNotesContainer)) {
                        clearInterval(noteInterval);
                        return;
                    }
                    createNote();
                }, 2000); // æ¯2ç§’ç”Ÿæˆä¸€å€‹æ–°éŸ³ç¬¦
                
                // å­˜å„²é–“éš”å®šæ™‚å™¨IDï¼Œä»¥ä¾¿åœ¨é é¢åˆ‡æ›æ™‚æ¸…é™¤
                musicNotesContainer.dataset.intervalId = noteInterval;
            }
            
            // é é¢åˆ‡æ›æ™‚æ¸…é™¤éŸ³ç¬¦ç”Ÿæˆå®šæ™‚å™¨
            function cleanupMusicNotes() {
                const musicNotesContainer = document.getElementById('music-notes-container');
                if (musicNotesContainer && musicNotesContainer.dataset.intervalId) {
                    clearInterval(parseInt(musicNotesContainer.dataset.intervalId));
                }
            }
        });
        
        // å…¨å±€è®Šæ•¸
        let port;
        let reader;
        let reading = false;
        let textDecoder = new TextDecoder();
        let accelerationCount = 0;
        
        // BPM è¨ˆç®—ç›¸é—œè®Šæ•¸
        let timestamps = [];
        let lastTimestamp = 0;
        let bpm = 0;
        let lastInterval = 0;
        
        // ä¿¡è™Ÿç¯€æµè®Šæ•¸
        let lastSignalTime = 0;
        const throttleTime = 420; // å›ºå®šç‚º 420 æ¯«ç§’
        let isProcessing = false;
        
        // éŠæˆ²ç›¸é—œè®Šæ•¸
        let gameActive = false;
        let gameStartTime = 0;
        let currentMusic = null;
        let targetBpm = 0;
        let gameTimer = null;
        let isPracticeMode = true; // åˆå§‹ç‚ºç·´ç¿’æ¨¡å¼
        let practiceEndTime = 0; // ç·´ç¿’æ¨¡å¼çµæŸæ™‚é–“
        const PRACTICE_DURATION = 10; // ç·´ç¿’æ¨¡å¼æŒçºŒ10ç§’
        let currentPlaybackRate = 1.0; // ç•¶å‰éŸ³æ¨‚æ’­æ”¾é€Ÿåº¦
        const FAST_PLAYBACK_RATE = 1.15; // å¿«é€Ÿæ’­æ”¾é€Ÿåº¦
        const SLOW_PLAYBACK_RATE = 0.85; // æ…¢é€Ÿæ’­æ”¾é€Ÿåº¦
        const BPM_THRESHOLD = 0.15; // BPMè®ŠåŒ–é–¾å€¼ (15%)
        let gameData = {
            totalBeats: 0,
            accurateBeats: 0, // BPMå·®ç•° < 5 çš„æº–ç¢ºç¯€æ‹
            bpmReadings: []
        };
        let accuracyTimeoutId = null;
        let speedNotificationTimeoutId = null;
        
        // èˆå°ç‡ˆå…‰å’Œè¦–è¦ºæ•ˆæœ
        let stageLighting = document.getElementById('stage-lighting');
        let melodyWave = document.getElementById('melody-wave');
        let isLightingActive = false;

        // éŸ³æ¨‚è³‡æºè¨­å®š
        const MUSIC_RESOURCES = {
            game_start: {
                url: 'https://cdn.jsdelivr.net/gh/iGitScor/Music-samples/wav/bubbles.wav',
                duration: 10,
                bpm: 0, // ééŠæˆ²éŸ³æ¨‚
                title: 'åºæ›²ï¼šèˆå°æº–å‚™'
            },
            waltz: {
                url: './audio/TheBlueDanube.mp3',
                duration: 30,
                bpm: 60,
                title: 'è¯çˆ¾æ»‹ï¼šè—è‰²å¤šç‘™æ²³',
                comment: 'å„ªé›…çš„ä¸‰æ‹å­ç¯€å¥ï¼Œå¦‚åŒåœ¨å®®å»·èˆæœƒæ—‹è½‰çš„èˆè€…'
            },
            march: {
                url: './audio/RadetzkyMarch.mp3',
                duration: 30,
                bpm: 108,
                title: 'é€²è¡Œæ›²ï¼šæ‹‰å¾·æ–¯åŸº',
                comment: 'ç²¾ç¥æŠ–æ“»çš„äºŒæ‹å­ç¯€å¥ï¼Œå¼•é ˜æ¨‚åœ˜å±•ç¾æ´»åŠ›èˆ‡åŠ›é‡'
            },
            symphony: {
                url: './audio/FateSymphony.mp3',
                duration: 30,
                bpm: 88,
                title: 'äº¤éŸ¿æ›²ï¼šå‘½é‹ä¹‹é–€',
                comment: 'é›„å‰çš„å››æ‹å­ç¯€å¥ï¼ŒæŒ‡æ®å®¶èˆ‡æ¨‚åœ˜çš„å®Œç¾å”å¥'
            }
        };

        // DOM å…ƒç´ 
        const connectButton = document.getElementById('connect-button');
        const connectionStatus = document.getElementById('connection-status');
        const connectionPanel = document.getElementById('connection-panel');
        const setupPanel = document.getElementById('setup-panel');
        const gamePanel = document.getElementById('game-panel');
        const resultPanel = document.getElementById('result-panel');
        const musicSelect = document.getElementById('music-select');
        const startMusicButton = document.getElementById('start-music-button');
        const stopGameButton = document.getElementById('stop-game-button');
        const playAgainButton = document.getElementById('play-again-button');
        const gameAudio = document.getElementById('game-audio');
        const currentBpmDisplay = document.getElementById('current-bpm');
        const targetBpmDisplay = document.getElementById('target-bpm');
        const bpmDiffDisplay = document.getElementById('bpm-diff');
        const bpmIndicator = document.getElementById('bpm-indicator');
        const accuracyBar = document.getElementById('accuracy-bar');
        const accuracyPercent = document.getElementById('accuracy-percent');
        const accuracyText = document.getElementById('accuracy-text');
        const progressBar = document.getElementById('progress-bar');
        const timeDisplay = document.getElementById('time-display');
        const conductorWand = document.getElementById('conductor-wand');

        // æ·»åŠ éµç›¤æ§åˆ¶æ”¯æŒ
        document.addEventListener('keydown', function(event) {
            if (gameActive && (event.code === 'Space' || event.code === 'ArrowUp')) {
                event.preventDefault();
                simulateBeat();
            }
        });
        
        // æ¨¡æ“¬æŒ‡æ®æ£’æ•²æ“Š
        function simulateBeat() {
            // ç¯€æµè™•ç†
            const now = performance.now();
            if (now - lastSignalTime < throttleTime) {
                return;
            }
            
            isProcessing = true;
            lastSignalTime = now;
            
            // è™•ç†æ•²æ“Š
            conductorBeat();
            
            setTimeout(() => {
                isProcessing = false;
            }, 50);
        }

        // æª¢æŸ¥ Web Serial API æ”¯æ´
        if (!('serial' in navigator)) {
            connectionStatus.textContent = 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ Micro:bit é€£æ¥ã€‚è«‹ä½¿ç”¨éµç›¤æ“ä½œã€‚';
            connectionStatus.classList.add('text-yellow-500');
            connectButton.textContent = 'ä½¿ç”¨éµç›¤æ¨¡å¼';
            connectButton.addEventListener('click', function() {
                setupPanel.classList.remove('hidden');
            });
        } else {
            // é€£æ¥æŒ‰éˆ•é»æ“Šäº‹ä»¶
            connectButton.addEventListener('click', async () => {
                try {
                    // è«‹æ±‚ serial port
                    port = await navigator.serial.requestPort();
                    await port.open({ baudRate: 115200 });
                    
                    connectionStatus.textContent = 'å·²é€£æ¥æŒ‡æ®æ£’';
                    connectionStatus.classList.add('text-green-400');
                    connectButton.textContent = 'é€£æ¥æˆåŠŸ';
                    connectButton.classList.add('bg-conductor-velvet/20');
                    connectButton.disabled = true;
                    
                    // æˆåŠŸé€£æ¥å¾Œï¼Œç›´æ¥é¡¯ç¤ºéŠæˆ²è¨­ç½®é¢æ¿
                    setupPanel.classList.remove('hidden');
                    
                    // é–‹å§‹è®€å–æ•¸æ“š
                    readSerialData();
                    
                } catch (error) {
                    console.error('é€£æ¥éŒ¯èª¤:', error);
                    connectionStatus.textContent = 'é€£æ¥å¤±æ•—ï¼Œè«‹ä½¿ç”¨éµç›¤æ“ä½œã€‚';
                    connectionStatus.classList.add('text-yellow-500');
                    setupPanel.classList.remove('hidden');
                }
            });
        }

        // å•Ÿå‹•ç‡ˆå…‰æ•ˆæœ
        function activateLighting() {
            if (!isLightingActive) {
                stageLighting.classList.add('active');
                isLightingActive = true;
            }
        }
        
        // è§¸ç™¼æ—‹å¾‹æ³¢æµªå‹•ç•«
        function triggerMelodyWave() {
            melodyWave.classList.remove('active');
            void melodyWave.offsetWidth; // è§¸ç™¼é‡æ’
            melodyWave.classList.add('active');
        }

        // é–‹å§‹éŠæˆ²æŒ‰éˆ•
        startMusicButton.addEventListener('click', startGame);
        
        // åœæ­¢éŠæˆ²æŒ‰éˆ•
        stopGameButton.addEventListener('click', endGame);
        
        // å†ç©ä¸€æ¬¡æŒ‰éˆ•
        playAgainButton.addEventListener('click', resetGame);

        // è®€å–ä¸²å£æ•¸æ“š
        async function readSerialData() {
            if (reading) return;
            
            reading = true;
            reader = port.readable.getReader();
            
            try {
                while (true) {
                    const { value, done } = await reader.read();
                    
                    if (done) {
                        break;
                    }
                    
                    // è™•ç†æ¥æ”¶åˆ°çš„æ•¸æ“š
                    processData(value);
                }
            } catch (error) {
                console.error('è®€å–éŒ¯èª¤:', error);
            } finally {
                reader.releaseLock();
                reading = false;
                
                // å¦‚æœé€£æ¥é‚„å­˜åœ¨ï¼Œå‰‡å˜—è©¦å†æ¬¡è®€å–
                if (port && port.readable) {
                    setTimeout(readSerialData, 100);
                } else {
                    connectionStatus.textContent = 'é€£æ¥å·²æ–·é–‹ï¼Œå¯ä½¿ç”¨éµç›¤æ“ä½œ';
                    connectionStatus.classList.remove('text-green-400');
                    connectionStatus.classList.add('text-yellow-500');
                    
                    // å¦‚æœéŠæˆ²æ­£åœ¨é€²è¡Œï¼Œå‰‡ç¹¼çºŒ
                    if (gameActive) {
                        // ä¸çµæŸéŠæˆ²ï¼Œè®“ç”¨æˆ¶å¯ä»¥ä½¿ç”¨éµç›¤ç¹¼çºŒ
                    }
                }
            }
        }

        // è™•ç†æ¥æ”¶åˆ°çš„æ•¸æ“š
        function processData(data) {
            const text = textDecoder.decode(data).trim();
            
            // æª¢æŸ¥æ˜¯å¦æ¥æ”¶åˆ° "b" ä¿¡è™Ÿ
            if (text.includes('b')) {
                // ç¯€æµè™•ç† - å¿½ç•¥ç¯€æµæ™‚é–“å…§çš„é€£çºŒä¿¡è™Ÿ
                const now = performance.now();
                if (now - lastSignalTime < throttleTime) {
                    return;
                }
                
                // å¦‚æœæ­£åœ¨è™•ç†ä¸­ï¼Œä¹Ÿå¿½ç•¥
                if (isProcessing) {
                    return;
                }
                
                isProcessing = true;
                lastSignalTime = now;
                
                // è™•ç†åŠ é€Ÿåº¦æª¢æ¸¬
                if (gameActive) {
                    conductorBeat();
                }
                
                // è¨­å®šçŸ­æ™‚é–“å¾Œé‡ç½®è™•ç†æ¨™èªŒï¼Œä»¥ç¢ºä¿ä¿¡è™Ÿè™•ç†å®Œç•¢
                setTimeout(() => {
                    isProcessing = false;
                }, 50);
            }
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            const musicKey = musicSelect.value;
            currentMusic = MUSIC_RESOURCES[musicKey];
            targetBpm = currentMusic.bpm;
            
            // å•Ÿå‹•ç‡ˆå…‰æ•ˆæœ
            activateLighting();
            
            // ä¸æ˜¯éŠæˆ²éŸ³æ¨‚å‰‡è¿”å›é¸æ“‡ç•Œé¢
            if (targetBpm === 0) {
                gameAudio.src = currentMusic.url;
                gameAudio.play();
                return;
            }
            
            // é‡ç½®éŠæˆ²æ•¸æ“š
            gameData = {
                totalBeats: 0,
                accurateBeats: 0,
                bpmReadings: []
            };
            
            // é‡ç½®ç·´ç¿’æ¨¡å¼
            isPracticeMode = true;
            
            // è¨­ç½®éŸ³é »ä¸¦æ’­æ”¾
            gameAudio.src = currentMusic.url;
            gameAudio.onloadedmetadata = () => {
                // æ›´æ–°ç•Œé¢
                connectionPanel.classList.add('hidden');
                setupPanel.classList.add('hidden');
                gamePanel.classList.remove('hidden');
                
                // é¡¯ç¤ºç·´ç¿’æ¨¡å¼æ©«å¹…
                const practiceBanner = document.getElementById('practice-mode-banner');
                const practiceCountdown = document.getElementById('practice-countdown');
                practiceBanner.classList.remove('hidden');
                practiceCountdown.textContent = PRACTICE_DURATION;
                
                // è¨­ç½®ç›®æ¨™ BPM é¡¯ç¤º
                targetBpmDisplay.textContent = targetBpm;
                currentBpmDisplay.textContent = '--';
                bpmDiffDisplay.textContent = '--';
                
                // é‡ç½® BPM æŒ‡ç¤ºå™¨
                bpmIndicator.style.left = '50%';
                
                // é‡ç½®ç²¾æº–åº¦
                accuracyBar.style.width = '0%';
                accuracyPercent.textContent = '0%';
                
                // é‡ç½®é€²åº¦æ¢
                updateProgressBar(0);
                
                // é–‹å§‹éŠæˆ²
                gameActive = true;
                gameStartTime = performance.now();
                gameAudio.play();
                
                // è¨­ç½®ç·´ç¿’çµæŸæ™‚é–“
                practiceEndTime = gameAudio.currentTime + PRACTICE_DURATION;
                
                // è¨­ç½®éŠæˆ²è¨ˆæ™‚å™¨
                const duration = gameAudio.duration;
                updateTimeDisplay(0, duration);
                
                // è¨­ç½®é€²åº¦æ›´æ–°å®šæ™‚å™¨
                gameTimer = setInterval(() => {
                    const currentTime = gameAudio.currentTime;
                    const duration = gameAudio.duration;
                    
                    updateProgressBar(currentTime / duration * 100);
                    updateTimeDisplay(currentTime, duration);
                    
                    // æ›´æ–°ç·´ç¿’æ¨¡å¼å€’è¨ˆæ™‚
                    if (isPracticeMode) {
                        const practiceTimeLeft = Math.max(0, Math.ceil(practiceEndTime - currentTime));
                        practiceCountdown.textContent = practiceTimeLeft;
                        
                        // ç·´ç¿’æ™‚é–“çµæŸ
                        if (practiceTimeLeft === 0) {
                            isPracticeMode = false;
                            
                            // éš±è—ç·´ç¿’æ¨¡å¼æç¤ºï¼Œé¡¯ç¤ºè½‰å ´å‹•ç•«å’Œæç¤º
                            practiceBanner.classList.add('hidden');
                            
                            // é‡ç½®è¨ˆåˆ†æ•¸æ“šï¼Œé–‹å§‹æ­£å¼è¨ˆåˆ†
                            gameData = {
                                totalBeats: 0,
                                accurateBeats: 0,
                                bpmReadings: []
                            };
                            
                            // é¡¯ç¤ºé–‹å§‹è¨ˆåˆ†æç¤º
                            showAccuracyFeedback('é–‹å§‹æ­£å¼è¨ˆåˆ†ï¼', 'text-conductor-gold');
                            
                            // é‡ç½®ç²¾æº–åº¦é¡¯ç¤º
                            accuracyBar.style.width = '0%';
                            accuracyPercent.textContent = '0%';
                        }
                    }
                    
                    // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
                    if (currentTime >= duration) {
                        endGame();
                    }
                }, 100);
            };
        }

        // è¨ˆç®— BPM - å¹³å‡æ³•
        function calculateAverageBPM() {
            if (timestamps.length < 2) return 0;
            
            // è¨ˆç®—æ™‚é–“é–“éš”ï¼ˆä»¥æ¯«ç§’ç‚ºå–®ä½ï¼‰
            const intervals = [];
            for (let i = 1; i < timestamps.length; i++) {
                intervals.push(timestamps[i] - timestamps[i - 1]);
            }
            
            // è¨ˆç®—å¹³å‡é–“éš”
            const averageInterval = intervals.reduce((sum, interval) => sum + interval, 0) / intervals.length;
            
            // è½‰æ›ç‚º BPMï¼ˆæ¯åˆ†é˜ç¯€æ‹æ•¸ï¼‰
            return Math.round(60000 / averageInterval);
        }
        
        // é¡¯ç¤ºéŸ³æ¨‚é€Ÿåº¦æç¤º
        function showSpeedNotification(text, bgColor) {
            const speedNotification = document.getElementById('speed-notification');
            const speedText = document.getElementById('speed-text');
            
            // æ¸…é™¤ä¹‹å‰çš„ timeout
            if (speedNotificationTimeoutId) {
                clearTimeout(speedNotificationTimeoutId);
            }
            
            // æ›´æ–°æ–‡å­—å’ŒèƒŒæ™¯è‰²
            speedText.textContent = text;
            speedNotification.style.backgroundColor = bgColor;
            
            // é¡¯ç¤ºé€šçŸ¥
            speedNotification.classList.remove('hidden');
            speedNotification.classList.add('scale-100');
            
            // è§¸ç™¼æ—‹å¾‹æ³¢æµªæ•ˆæœ
            triggerMelodyWave();
            
            // è¨­ç½®æ·¡å‡º
            speedNotificationTimeoutId = setTimeout(() => {
                speedNotification.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    speedNotification.classList.add('hidden');
                    speedNotification.classList.remove('scale-95', 'opacity-0');
                }, 300);
            }, 2000);
        }
        
        // èª¿æ•´éŸ³æ¨‚æ’­æ”¾é€Ÿåº¦
        function adjustPlaybackRate(newBpm) {
            if (!gameAudio || isPracticeMode) return;
            
            let newRate = 1.0;
            
            // æ ¹æ“š BPM å·®ç•°èª¿æ•´æ’­æ”¾é€Ÿåº¦
            if (newBpm > targetBpm * (1 + BPM_THRESHOLD)) {
                newRate = FAST_PLAYBACK_RATE;
            } else if (newBpm < targetBpm * (1 - BPM_THRESHOLD)) {
                newRate = SLOW_PLAYBACK_RATE;
            }
            
            // åªæœ‰ç•¶é€Ÿåº¦æ”¹è®Šæ™‚æ‰æ›´æ–°
            if (newRate !== currentPlaybackRate) {
                // æ›´æ–°æ’­æ”¾é€Ÿåº¦
                gameAudio.playbackRate = newRate;
                currentPlaybackRate = newRate;
                
                // é¡¯ç¤ºé€Ÿåº¦è®ŠåŒ–é€šçŸ¥
                if (newRate === FAST_PLAYBACK_RATE) {
                    showSpeedNotification('æ¨‚åœ˜åŠ é€Ÿï¼æ‚¨çš„ç¯€å¥éå¿«', '#FF9800');
                } else if (newRate === SLOW_PLAYBACK_RATE) {
                    showSpeedNotification('æ¨‚åœ˜æ¸›é€Ÿï¼æ‚¨çš„ç¯€å¥éæ…¢', '#2196F3');
                } else {
                    showSpeedNotification('æ¨‚åœ˜è·Ÿéš¨æ‚¨çš„é ˜å°ï¼Œç¯€å¥æ¢å¾©', '#4CAF50');
                }
            }
        }
        
        // æŒ‡æ®å‹•ä½œ
        function conductorBeat() {
            accelerationCount++;
            const now = performance.now();
            
            // æ·»åŠ æŒ‡æ®æ£’å‹•ç•«
            conductorWand.classList.add('conducting');
            setTimeout(() => {
                conductorWand.classList.remove('conducting');
            }, 400);
            
            // è§¸ç™¼æ—‹å¾‹æ³¢æµª
            triggerMelodyWave();
            
            // è¨˜éŒ„æ™‚é–“æˆ³ä»¥è¨ˆç®—å¹³å‡ BPM
            timestamps.push(now);
            
            // ä¿æŒå›ºå®šæ•¸é‡çš„æ¨£æœ¬ (æœ€è¿‘5å€‹)
            if (timestamps.length > 5) {
                timestamps.shift();
            }
            
            let newBpm = 0;
            let interval = 0;
            
            if (lastTimestamp) {
                interval = now - lastTimestamp;
                lastInterval = interval;
                
                // åªæœ‰åœ¨åˆç†ç¯„åœå…§çš„é–“éš”æ‰è¨ˆç®— BPMï¼ˆ300-2000ms å¤§è‡´å°æ‡‰ 30-200 BPMï¼‰
                if (interval >= 300 && interval <= 2000) {
                    // ä½¿ç”¨å¹³å‡å€¼è¨ˆç®— BPM
                    newBpm = calculateAverageBPM();
                    
                    // æ›´æ–°ç•¶å‰ BPM é¡¯ç¤º
                    currentBpmDisplay.textContent = newBpm;
                    currentBpmDisplay.classList.add('bpm-pulse');
                    setTimeout(() => {
                        currentBpmDisplay.classList.remove('bpm-pulse');
                    }, 500);
                    
                    // è¨ˆç®—èˆ‡ç›®æ¨™ BPM çš„å·®ç•°
                    const bpmDiff = newBpm - targetBpm;
                    
                    // æ›´æ–° BPM å·®ç•°é¡¯ç¤º
                    if (bpmDiff > 0) {
                        bpmDiffDisplay.textContent = `+${bpmDiff} (éå¿«)`;
                    } else if (bpmDiff < 0) {
                        bpmDiffDisplay.textContent = `${bpmDiff} (éæ…¢)`;
                    } else {
                        bpmDiffDisplay.textContent = `å®Œç¾!`;
                    }
                    
                    // æ›´æ–° BPM æŒ‡ç¤ºå™¨ä½ç½®
                    const indicatorPos = Math.max(0, Math.min(100, 50 + (bpmDiff / targetBpm * 50)));
                    bpmIndicator.style.left = `${indicatorPos}%`;
                    
                    // BPM æŒ‡ç¤ºå™¨è„ˆå‹•æ•ˆæœ
                    bpmIndicator.classList.add('animate-pulse');
                    setTimeout(() => {
                        bpmIndicator.classList.remove('animate-pulse');
                    }, 500);
                    
                    // èª¿æ•´éŸ³æ¨‚æ’­æ”¾é€Ÿåº¦
                    adjustPlaybackRate(newBpm);
                    
                    // åªæœ‰åœ¨éç·´ç¿’æ¨¡å¼ä¸‹æ‰æ›´æ–°è¨ˆåˆ†
                    if (!isPracticeMode) {
                        // æ›´æ–°éŠæˆ²æ•¸æ“š
                        gameData.totalBeats++;
                        gameData.bpmReadings.push(newBpm);
                        
                        // æ·»åŠ æŒ‡æ®åé¥‹æ•ˆæœ
                        document.querySelectorAll('.reactive-indicator').forEach(el => {
                            el.classList.add('active');
                            setTimeout(() => {
                                el.classList.remove('active');
                            }, 300);
                        });
                        
                        // æ›´æ–°ç²¾æº–åº¦
                        if (Math.abs(bpmDiff) <= 5) {
                            gameData.accurateBeats++;
                            showAccuracyFeedback('ç²¾å½©ï¼å®Œç¾ç¯€å¥', 'text-green-400');
                        } else if (Math.abs(bpmDiff) <= 10) {
                            showAccuracyFeedback('æ¨‚åœ˜è·Ÿéš¨æ‚¨çš„æŒ‡æ®', 'text-yellow-400');
                        } else {
                            showAccuracyFeedback('èª¿æ•´æ‚¨çš„æŒ‡æ®ç¯€å¥', 'text-red-400');
                        }
                        
                        // è¨ˆç®—ä¸¦æ›´æ–°ç²¾æº–åº¦ç™¾åˆ†æ¯”
                        const accuracy = (gameData.accurateBeats / gameData.totalBeats * 100).toFixed(0);
                        accuracyBar.style.width = `${accuracy}%`;
                        accuracyPercent.textContent = `${accuracy}%`;
                    } else {
                        // ç·´ç¿’æ¨¡å¼ä¸‹çš„åé¥‹
                        if (Math.abs(bpmDiff) <= 5) {
                            showAccuracyFeedback('æ„Ÿå—æ¨‚æ›²çš„è„ˆå‹•...', 'text-blue-400');
                        } else if (Math.abs(bpmDiff) <= 10) {
                            showAccuracyFeedback('å°‹æ‰¾éŸ³æ¨‚çš„ç¯€å¥...', 'text-blue-400');
                        } else {
                            showAccuracyFeedback('ç†Ÿæ‚‰æ¨‚åœ˜çš„å‘¼å¸...', 'text-blue-400');
                        }
                    }
                }
            }
            
            // æ›´æ–°æœ€å¾Œä¸€æ¬¡æ™‚é–“æˆ³
            lastTimestamp = now;
        }

        // é¡¯ç¤ºç²¾æº–åº¦åé¥‹
        function showAccuracyFeedback(text, colorClass) {
            // æ¸…é™¤ä¹‹å‰çš„ timeout
            if (accuracyTimeoutId) {
                clearTimeout(accuracyTimeoutId);
            }
            
            // ç§»é™¤ä¹‹å‰çš„é¡è‰²é¡ä¸¦æ·»åŠ æ–°é¡
            accuracyText.className = 'accuracy-text transition-colors ' + colorClass;
            accuracyText.textContent = text;
            accuracyText.classList.add('show');
            
            // è¨­ç½®æ·¡å‡º
            accuracyTimeoutId = setTimeout(() => {
                accuracyText.classList.remove('show');
            }, 1500);
        }

        // æ›´æ–°é€²åº¦æ¢
        function updateProgressBar(percent) {
            progressBar.style.width = `${percent}%`;
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateTimeDisplay(currentTime, duration) {
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };
            
            timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        }

        // çµæŸéŠæˆ²
        function endGame() {
            // åœæ­¢éŸ³æ¨‚å’Œè¨ˆæ™‚å™¨
            gameAudio.pause();
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            
            // æ¨™è¨˜éŠæˆ²çµæŸ
            gameActive = false;
            
            // æ›´æ–°ç•Œé¢
            gamePanel.classList.add('hidden');
            resultPanel.classList.remove('hidden');
            
            // è¨ˆç®—éŠæˆ²çµæœ
            const totalBeats = gameData.totalBeats;
            const accurateBeats = gameData.accurateBeats;
            const accuracy = totalBeats > 0 ? (accurateBeats / totalBeats * 100).toFixed(0) : 0;
            
            // è¨ˆç®—å¹³å‡ BPM
            let averageBpm = 0;
            if (gameData.bpmReadings.length > 0) {
                averageBpm = Math.round(
                    gameData.bpmReadings.reduce((sum, bpm) => sum + bpm, 0) / gameData.bpmReadings.length
                );
            }
            
            // è¨­ç½®çµæœæ¨™é¡Œå’Œè©•ç´š
            let resultTitle = '';
            let resultComment = '';
            
            if (accuracy >= 90) {
                resultTitle = 'å¤§å¸«ç´šæŒ‡æ®ï¼';
                resultComment = 'æ‚¨çš„è—è¡“é¢¨é‡‡å¦‚æš´é¢¨èˆ¬å¸­æ²å…¨å ´ï¼Œæ¨‚åœ˜åœ¨æ‚¨çš„æŒ‡æ®ä¸‹ç¶»æ”¾æœ€ç’€ç’¨çš„å…‰èŠ’ï¼';
            } else if (accuracy >= 70) {
                resultTitle = 'ç²¾æ¹›æŒ‡æ®å®¶ï¼';
                resultComment = 'æ‚¨å°éŸ³æ¨‚çš„ç†è§£èˆ‡æ„ŸæŸ“åŠ›è®“æ¨‚åœ˜èˆ‡æ‚¨å¿ƒéˆç›¸é€šï¼Œæ¼”ç¹¹å‡ºå‹•äººçš„æ¨‚ç« ï¼';
            } else if (accuracy >= 50) {
                resultTitle = 'æœ‰æ½›åŠ›çš„æŒ‡æ®å®¶';
                resultComment = 'æ‚¨å…·å‚™è‡ªç„¶çš„éŸ³æ¨‚å¤©è³¦ï¼Œéš¨è‘—ç¶“é©—çš„ç´¯ç©ï¼Œçµ‚å°‡æˆå°±éå‡¡çš„æŒ‡æ®ç”Ÿæ¶¯ï¼';
            } else {
                resultTitle = 'åˆå­¸æŒ‡æ®å®¶';
                resultComment = 'éŸ³æ¨‚æ˜¯ä¸€æ®µç¾éº—çš„æ—…ç¨‹ï¼ŒæŒçºŒç·´ç¿’èˆ‡æ„Ÿå—ï¼Œæ‚¨å°‡ç™¼ç¾æŒ‡æ®çš„ç„¡çª®æ¨‚è¶£ï¼';
            }
            
            // æ›´æ–°çµæœé¢æ¿
            document.getElementById('result-title').textContent = resultTitle;
            document.getElementById('result-score').textContent = `${accuracy}%`;
            document.getElementById('result-target-bpm').textContent = targetBpm;
            document.getElementById('result-average-bpm').textContent = averageBpm || '--';
            document.getElementById('result-accurate-beats').textContent = accurateBeats;
            document.getElementById('result-total-beats').textContent = totalBeats;
            document.getElementById('result-comment').textContent = resultComment;
        }

        // é‡ç½®éŠæˆ²
        function resetGame() {
            resultPanel.classList.add('hidden');
            setupPanel.classList.remove('hidden');
            
            // é‡ç½®éŠæˆ²æ•¸æ“š
            lastTimestamp = 0;
            accelerationCount = 0;
            gameData = {
                totalBeats: 0,
                accurateBeats: 0,
                bpmReadings: []
            };
        }
    </script>
</body>
</html>
